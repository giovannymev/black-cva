import React, { useState, useEffect } from 'react';
import { BRAZIL_STATES } from '../constants';
import { CheckCircle2 } from 'lucide-react';

interface Toast {
  id: number;
  state: string;
}

// Short, subtle notification sound (Base64 MP3)
const NOTIFICATION_SOUND = "data:audio/mp3;base64,SUQzBAAAAAABAFRYWFgAAAASAAADbWFqb3JfYnJhbmQAbXA0MgBURW5jAAAAHgAAA0xhdmY1Ny44My4xMDAAbGliYTY0AAADpAAAAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAAAAAAAABAAAAAAAEsAAAAKHUAAABAAAAAAABIAAABH////4AAAKgAAAAASaAAAAAAAB//uQxAsAAAgAAAA0AAAAKAAADSAAAABAAAAAAAASAAAAEf///+AAACoAAAAAEmgAAAAAAAf/7kMQfAAACAAAAAwAAAAoAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxD8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxF8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxH8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxJ8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxL8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxN8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxP8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxR8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxT8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxV8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxX8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxZ8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxb8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxd8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxf8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxh8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxj8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxk8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxm8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxo8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxq8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxs8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxu8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxw8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQxy8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQx08AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQx28AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQx48AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQx68AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQx88AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQx+8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyA8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyC8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyE8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyG8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyI8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyK8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyM8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyO8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyQ8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyS8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyU8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyW8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyY8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQya8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyc8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQye8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyg8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyi8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyk8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQym8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyo8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyq8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQys8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyu8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyw8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQyy8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQy08AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQy28AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQy48AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQy68AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQy88AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQy+8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzA8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzC8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzE8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzG8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzI8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzK8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzM8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzO8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzQ8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzS8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzU8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzW8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzY8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQza8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzc8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQze8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzg8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzi8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzk8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzm8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzo8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzq8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzs8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzu8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzw8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQzy8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQz08AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQz28AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQz48AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQz68AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQz88AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB//uQz+8AAIAAAABAAAACgAAA0gAAAAQAAAAAAAEgAAAEf///+AAACoAAAAASaAAAAAAAB";

export const SocialProofToast: React.FC = () => {
  const [toast, setToast] = useState<Toast | null>(null);
  const [isVisible, setIsVisible] = useState(false);

  const playSound = () => {
    try {
      const audio = new Audio(NOTIFICATION_SOUND);
      audio.volume = 0.4;
      // Browsers often block autoplay until the user interacts with the document.
      // We use catch to prevent errors in the console if the user hasn't clicked yet.
      audio.play().catch((e) => {
        // Expected behavior if no interaction yet, ignore.
      });
    } catch (error) {
      // Fallback for any other audio errors
    }
  };

  useEffect(() => {
    // Initial delay
    const initialTimeout = setTimeout(() => {
      triggerToast();
    }, 2000);

    const interval = setInterval(() => {
      setIsVisible(false); // Hide current
      
      setTimeout(() => {
        triggerToast();
      }, 500); // Wait for exit animation then show new one
      
    }, 6000); // Cycle every 6 seconds

    return () => {
      clearTimeout(initialTimeout);
      clearInterval(interval);
    };
  }, []);

  const triggerToast = () => {
    const randomState = BRAZIL_STATES[Math.floor(Math.random() * BRAZIL_STATES.length)];
    setToast({ id: Date.now(), state: randomState });
    setIsVisible(true);
    playSound();
  };

  if (!toast) return null;

  return (
    <div 
      className={`fixed left-1/2 -translate-x-1/2 z-40 max-w-[95vw] w-max transition-all duration-700 ease-out pointer-events-none ${
        isVisible ? 'top-20 opacity-100' : 'top-0 opacity-0'
      }`}
    >
      <div className="bg-zinc-950/90 backdrop-blur-md border border-zinc-800 rounded-full pl-2 pr-5 py-2 shadow-2xl shadow-black flex items-center gap-3">
        <div className="shrink-0 bg-green-500/10 p-1.5 rounded-full border border-green-500/20">
          <CheckCircle2 className="w-4 h-4 text-green-500" />
        </div>
        <div className="flex flex-col sm:flex-row sm:items-center gap-0.5 sm:gap-1.5 text-center sm:text-left">
          <span className="text-gray-300 text-xs sm:text-sm">
            Algu√©m de <span className="text-orange-400 font-bold">{toast.state}</span>
          </span>
          <span className="text-gray-500 text-xs sm:text-sm hidden sm:inline">-</span>
          <span className="text-gray-400 text-xs sm:text-sm">
            clicou em <strong className="text-white font-semibold">aproveitar oferta</strong>
          </span>
        </div>
      </div>
    </div>
  );
};